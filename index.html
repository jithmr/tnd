<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>World Time Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
}

.container {
  max-width: 1000px;
  margin: auto;
  padding: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 6px;
}

#status {
  text-align: center;
  font-size: 14px;
  margin-bottom: 15px;
}

.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 15px;
}

select, button {
  padding: 10px;
  border-radius: 6px;
  border: none;
  font-size: 14px;
}

button {
  background: #2563eb;
  color: white;
  cursor: pointer;
}

button:hover {
  background: #1d4ed8;
}

button.sync {
  background: #16a34a;
}

button.sync:hover {
  background: #15803d;
}

.toggle {
  display: flex;
  align-items: center;
  gap: 6px;
}

.clocks {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 15px;
}

.clock {
  background: #020617;
  padding: 15px;
  border-radius: 10px;
  position: relative;
  text-align: center;
  box-shadow: 0 8px 25px rgba(0,0,0,0.4);
}

.clock button.remove {
  position: absolute;
  top: 6px;
  right: 6px;
  background: transparent;
  color: #ef4444;
  border: none;
  font-size: 16px;
  cursor: pointer;
}

.clock button.remove:hover {
  color: #f87171;
}

.clock h3 {
  margin: 0 0 6px;
  font-size: 14px;
  color: #93c5fd;
}

.time {
  font-size: 22px;
  font-weight: bold;
}

.offset {
  font-size: 12px;
  color: #a5b4fc;
}

.date {
  font-size: 13px;
  color: #94a3b8;
}
</style>
</head>

<body>

<div class="container">
  <h1>üåç World Time Pro</h1>
  <div id="status">Detecting location & syncing time‚Ä¶</div>

  <div class="controls">
    <select id="regionSelect"></select>
    <select id="offsetSelect">
      <option value="">Select UTC offset</option>
    </select>

    <button onclick="addClock()">Add Clock</button>
    <button class="sync" onclick="manualSync()">Sync Now</button>

    <div class="toggle">
      <input type="checkbox" id="formatToggle">
      <label for="formatToggle">24-Hour</label>
    </div>
  </div>

  <div class="clocks" id="clocks"></div>
</div>

<script>
const clocksDiv = document.getElementById("clocks");
const regionSelect = document.getElementById("regionSelect");
const offsetSelect = document.getElementById("offsetSelect");
const formatToggle = document.getElementById("formatToggle");
const statusEl = document.getElementById("status");

let baseTime = new Date();
let lastSync = Date.now();
let detectedTZ = "Asia/Kolkata";

// üåê Internet time + location detection
async function syncTimeAndLocation(showMessage = true) {
  try {
    if (showMessage) {
      statusEl.textContent = "‚è≥ Syncing with internet time‚Ä¶";
      statusEl.style.color = "#eab308";
    }

    const res = await fetch("https://worldtimeapi.org/api/ip", { cache: "no-store" });
    const data = await res.json();

    baseTime = new Date(data.utc_datetime);
    lastSync = Date.now();
    detectedTZ = data.timezone || detectedTZ;

    statusEl.textContent = "üü¢ Internet synced ‚úîÔ∏è";
    statusEl.style.color = "#22c55e";
  } catch {
    baseTime = new Date();
    lastSync = Date.now();

    statusEl.textContent = "üî¥ Offline ‚ùå (using system time)";
    statusEl.style.color = "#ef4444";
  }
}

function manualSync() {
  syncTimeAndLocation(true);
}

function getNow() {
  return new Date(baseTime.getTime() + (Date.now() - lastSync));
}

syncTimeAndLocation(false);
setInterval(() => syncTimeAndLocation(false), 5 * 60 * 1000);

// üåç Unique regions
const regions = [
  ["Argentina", "America/Argentina/Buenos_Aires"],
  ["Australia ‚Äì Eastern", "Australia/Sydney"],
  ["Australia ‚Äì Central", "Australia/Adelaide"],
  ["Australia ‚Äì Western", "Australia/Perth"],
  ["Austria", "Europe/Vienna"],
  ["Bangladesh", "Asia/Dhaka"],
  ["Belgium", "Europe/Brussels"],
  ["Brazil ‚Äì S√£o Paulo", "America/Sao_Paulo"],
  ["Canada ‚Äì Eastern", "America/Toronto"],
  ["Canada ‚Äì Central", "America/Winnipeg"],
  ["Canada ‚Äì Pacific", "America/Vancouver"],
  ["China", "Asia/Shanghai"],
  ["France", "Europe/Paris"],
  ["Germany", "Europe/Berlin"],
  ["India", "Asia/Kolkata"],
  ["Italy", "Europe/Rome"],
  ["Japan", "Asia/Tokyo"],
  ["Mexico ‚Äì Central", "America/Mexico_City"],
  ["Mexico ‚Äì Pacific", "America/Tijuana"],
  ["Russia ‚Äì Moscow", "Europe/Moscow"],
  ["Russia ‚Äì Novosibirsk", "Asia/Novosibirsk"],
  ["Russia ‚Äì Vladivostok", "Asia/Vladivostok"],
  ["South Africa", "Africa/Johannesburg"],
  ["South Korea", "Asia/Seoul"],
  ["UK", "Europe/London"],
  ["USA ‚Äì Eastern", "America/New_York"],
  ["USA ‚Äì Central", "America/Chicago"],
  ["USA ‚Äì Mountain", "America/Denver"],
  ["USA ‚Äì Pacific", "America/Los_Angeles"],
  ["USA ‚Äì Alaska", "America/Anchorage"],
  ["USA ‚Äì Hawaii", "Pacific/Honolulu"]
];

// Populate region dropdown
regions
  .sort((a,b)=>a[0].localeCompare(b[0]))
  .forEach(r => {
    const opt = document.createElement("option");
    opt.value = r[1];
    opt.textContent = r[0];
    regionSelect.appendChild(opt);
  });

// UTC offsets
for (let m = -720; m <= 840; m += 30) {
  const sign = m >= 0 ? "+" : "‚àí";
  const abs = Math.abs(m);
  const h = String(Math.floor(abs / 60)).padStart(2,"0");
  const min = String(abs % 60).padStart(2,"0");

  const opt = document.createElement("option");
  opt.value = m;
  opt.textContent = `UTC ${sign}${h}:${min}`;
  offsetSelect.appendChild(opt);
}

// ‚ûï Add clock
function addClock(tz = null, label = null) {
  const clock = document.createElement("div");
  clock.className = "clock";

  clock.innerHTML = `
    <button class="remove" onclick="this.parentElement.remove()">‚úñ</button>
    <h3></h3>
    <div class="time">--:--</div>
    <div class="offset">---</div>
    <div class="date">---</div>
  `;

  if (tz) {
    clock.dataset.tz = tz;
    clock.querySelector("h3").textContent = label;
  } else if (offsetSelect.value) {
    clock.dataset.offset = offsetSelect.value;
    clock.querySelector("h3").textContent = offsetSelect.selectedOptions[0].text;
    clock.querySelector(".offset").textContent = offsetSelect.selectedOptions[0].text;
  } else {
    clock.dataset.tz = regionSelect.value;
    clock.querySelector("h3").textContent = regionSelect.selectedOptions[0].text;
  }

  clocksDiv.appendChild(clock);
}

// ‚è± Update clocks
function updateClocks() {
  const now = getNow();
  const use24h = formatToggle.checked;

  document.querySelectorAll(".clock").forEach(clock => {
    let d = now;

    if (clock.dataset.offset) {
      d = new Date(now.getTime() + clock.dataset.offset * 60000);
      clock.querySelector(".offset").textContent =
        offsetSelect.querySelector(`option[value="${clock.dataset.offset}"]`).text;
    }

    if (clock.dataset.tz) {
      const offsetFmt = new Intl.DateTimeFormat("en", {
        timeZone: clock.dataset.tz,
        timeZoneName: "shortOffset"
      });
      const offset = offsetFmt.formatToParts(d)
        .find(p => p.type === "timeZoneName").value;
      clock.querySelector(".offset").textContent = offset.replace("GMT","UTC");
    }

    const timeFmt = new Intl.DateTimeFormat("en-IN", {
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit",
      hour12: !use24h
    });

    const dateFmt = new Intl.DateTimeFormat("en-IN", {
      weekday: "short",
      day: "numeric",
      month: "short",
      year: "numeric"
    });

    clock.querySelector(".time").textContent = timeFmt.format(d);
    clock.querySelector(".date").textContent = dateFmt.format(d);
  });
}

setInterval(updateClocks, 1000);
updateClocks();

// üü¢ Auto-add detected location clock
setTimeout(() => {
  const match = regions.find(r => r[1] === detectedTZ);
  addClock(
    detectedTZ,
    match ? match[0] + " (Your location)" : "Your Location"
  );
}, 800);
</script>

</body>
</html>
