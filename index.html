<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>World Time Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
}
.container {
  max-width: 1000px;
  margin: auto;
  padding: 20px;
}
h1 {
  text-align: center;
  margin-bottom: 6px;
}
#status {
  text-align: center;
  font-size: 14px;
  margin-bottom: 15px;
}
.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 15px;
}
select, button {
  padding: 10px;
  border-radius: 6px;
  border: none;
  font-size: 14px;
}
button {
  background: #2563eb;
  color: white;
  cursor: pointer;
}
button:hover { background: #1d4ed8; }
button.sync {
  background: #16a34a;
}
button.sync:hover { background: #15803d; }

.toggle {
  display: flex;
  align-items: center;
  gap: 6px;
}

.clocks {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 15px;
}

.clock {
  background: #020617;
  padding: 15px;
  border-radius: 10px;
  position: relative;
  text-align: center;
  box-shadow: 0 8px 25px rgba(0,0,0,0.4);
}

.clock .remove {
  position: absolute;
  top: 6px;
  right: 6px;
  background: transparent;
  border: none;
  color: #ef4444;
  font-size: 16px;
  cursor: pointer;
}

.clock h3 {
  margin: 0 0 6px;
  font-size: 14px;
  color: #93c5fd;
}
.time {
  font-size: 22px;
  font-weight: bold;
}
.offset {
  font-size: 12px;
  color: #a5b4fc;
}
.date {
  font-size: 13px;
  color: #94a3b8;
}
</style>
</head>

<body>

<div class="container">
  <h1>üåç World Time Pro</h1>
  <div id="status">Syncing with internet time‚Ä¶</div>

  <div class="controls">
    <select id="regionSelect"></select>
    <select id="offsetSelect">
      <option value="">Select UTC offset</option>
    </select>

    <button onclick="addClock()">Add Clock</button>
    <button class="sync" onclick="manualSync()">Sync Now</button>

    <div class="toggle">
      <input type="checkbox" id="formatToggle">
      <label>24-Hour</label>
    </div>
  </div>

  <div class="clocks" id="clocks"></div>
</div>

<script>
const clocksDiv = document.getElementById("clocks");
const regionSelect = document.getElementById("regionSelect");
const offsetSelect = document.getElementById("offsetSelect");
const formatToggle = document.getElementById("formatToggle");
const statusEl = document.getElementById("status");

let baseUTC = Date.now();
let lastSync = Date.now();
let detectedTZ = "Asia/Kolkata";

// üåê Internet time sync (UTC only)
async function syncTime(showMsg = true) {
  try {
    if (showMsg) {
      statusEl.textContent = "‚è≥ Syncing with internet time‚Ä¶";
      statusEl.style.color = "#eab308";
    }
    const res = await fetch("https://worldtimeapi.org/api/ip", { cache: "no-store" });
    const data = await res.json();

    baseUTC = new Date(data.utc_datetime).getTime();
    lastSync = Date.now();
    detectedTZ = data.timezone || detectedTZ;

    statusEl.textContent = "üü¢ Internet synced ‚úîÔ∏è";
    statusEl.style.color = "#22c55e";
  } catch {
    baseUTC = Date.now();
    lastSync = Date.now();
    statusEl.textContent = "üî¥ Offline ‚ùå (system time)";
    statusEl.style.color = "#ef4444";
  }
}

function manualSync() {
  syncTime(true);
}

syncTime(false);
setInterval(() => syncTime(false), 5 * 60 * 1000);

// Always return current UTC-based time
function getUTCNow() {
  return new Date(baseUTC + (Date.now() - lastSync));
}

// üåç Regions (unique time zones)
const regions = [
  ["India", "Asia/Kolkata"],
  ["UK", "Europe/London"],
  ["France", "Europe/Paris"],
  ["Germany", "Europe/Berlin"],
  ["Japan", "Asia/Tokyo"],
  ["China", "Asia/Shanghai"],

  ["USA ‚Äì Eastern", "America/New_York"],
  ["USA ‚Äì Central", "America/Chicago"],
  ["USA ‚Äì Mountain", "America/Denver"],
  ["USA ‚Äì Pacific", "America/Los_Angeles"],

  ["Australia ‚Äì Eastern", "Australia/Sydney"],
  ["Australia ‚Äì Central", "Australia/Adelaide"],
  ["Australia ‚Äì Western", "Australia/Perth"],

  ["Russia ‚Äì Moscow", "Europe/Moscow"],
  ["Russia ‚Äì Vladivostok", "Asia/Vladivostok"]
];

regions.sort((a,b)=>a[0].localeCompare(b[0]))
  .forEach(r=>{
    const o=document.createElement("option");
    o.value=r[1];
    o.textContent=r[0];
    regionSelect.appendChild(o);
  });

// UTC offset list
for (let m=-720; m<=840; m+=30) {
  const sign = m>=0?"+":"‚àí";
  const h = String(Math.floor(Math.abs(m)/60)).padStart(2,"0");
  const min = String(Math.abs(m)%60).padStart(2,"0");
  const o=document.createElement("option");
  o.value=m;
  o.textContent=`UTC ${sign}${h}:${min}`;
  offsetSelect.appendChild(o);
}

// ‚ûï Add clock
function addClock(tz=null,label=null) {
  const c=document.createElement("div");
  c.className="clock";
  c.innerHTML=`
    <button class="remove" onclick="this.parentElement.remove()">‚úñ</button>
    <h3></h3>
    <div class="time">--:--</div>
    <div class="offset">---</div>
    <div class="date">---</div>
  `;

  if (tz) {
    c.dataset.tz=tz;
    c.querySelector("h3").textContent=label;
  } else if (offsetSelect.value) {
    c.dataset.offset=offsetSelect.value;
    c.querySelector("h3").textContent=offsetSelect.selectedOptions[0].text;
  } else {
    c.dataset.tz=regionSelect.value;
    c.querySelector("h3").textContent=regionSelect.selectedOptions[0].text;
  }
  clocksDiv.appendChild(c);
}

// ‚è± Update clocks correctly
function updateClocks() {
  const utcNow = getUTCNow();
  const use24 = formatToggle.checked;

  document.querySelectorAll(".clock").forEach(c=>{
    let dateObj = utcNow;

    if (c.dataset.offset) {
      dateObj = new Date(utcNow.getTime() + c.dataset.offset*60000);
      c.querySelector(".offset").textContent =
        offsetSelect.querySelector(`option[value="${c.dataset.offset}"]`).text;
    }

    if (c.dataset.tz) {
      const tz = c.dataset.tz;

      const timeFmt = new Intl.DateTimeFormat("en-IN", {
        timeZone: tz,
        hour:"2-digit", minute:"2-digit", second:"2-digit",
        hour12: !use24
      });

      const dateFmt = new Intl.DateTimeFormat("en-IN", {
        timeZone: tz,
        weekday:"short", day:"numeric", month:"short", year:"numeric"
      });

      const offFmt = new Intl.DateTimeFormat("en", {
        timeZone: tz,
        timeZoneName: "shortOffset"
      });

      c.querySelector(".time").textContent = timeFmt.format(utcNow);
      c.querySelector(".date").textContent = dateFmt.format(utcNow);
      c.querySelector(".offset").textContent =
        offFmt.formatToParts(utcNow).find(p=>p.type==="timeZoneName").value.replace("GMT","UTC");
    } else {
      const tf = new Intl.DateTimeFormat("en-IN", {
        hour:"2-digit", minute:"2-digit", second:"2-digit",
        hour12: !use24
      });
      const df = new Intl.DateTimeFormat("en-IN", {
        weekday:"short", day:"numeric", month:"short", year:"numeric"
      });
      c.querySelector(".time").textContent = tf.format(dateObj);
      c.querySelector(".date").textContent = df.format(dateObj);
    }
  });
}

setInterval(updateClocks,1000);
updateClocks();

// üü¢ Auto-add detected location
setTimeout(()=>{
  const match=regions.find(r=>r[1]===detectedTZ);
  addClock(detectedTZ, match?match[0]+" (Your location)":"Your Location");
},800);
</script>

</body>
</html>
